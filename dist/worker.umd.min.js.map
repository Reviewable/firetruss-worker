{"version":3,"sources":["../src/worker.js"],"names":["errorToJson","error","json","name","message","propertyNames","Object","getOwnPropertyNames","i","list","length","const","propertyName","normalizeFirebaseValue","value","Array","isArray","let","normalValue","item","undefined","key","hasOwnProperty","userToJson","user","Promise","resolve","toJSON","stsTokenManager","getIdTokenResult","then","result","claims","exp","iat","areEqualNormalFirebaseValues","a","b","areEqualValues","acceptConnections","onconnect","self","event","fireworkers","push","Fireworker","ports","localStorage","flushPending","apps","LocalStorage","this","_items","_pendingItems","_initialized","_flushPending","bind","prototype","init","items","_update","setTimeout","_send","msg","prototypeAccessors","get","n","getItem","setItem","targetItem","removeItem","this$1","splice","clear","Branch","_root","set","diff","pathPrefix","updates","segments","split","_diffRecursively","oldValue","newValue","replace","keysToReplace","childKey","replaceChild","concat","join","port","_port","_lastWriteSerial","_lastJsonUser","_configError","_callbacks","_messages","_flushMessageQueue","onmessage","_receive","ref","storage","config","databaseURL","firebase","initializeApp","_app","database","auth","e","exposedFunctionNames","keys","_exposed","version","firebaseSdkVersion","SDK_VERSION","destroy","callback","cancel","k","indexOf","ping","bounceConnection","Error","goOffline","goOnline","_firstMessageReceived","data","_receiveMessage","promise","fn","writeSerial","Math","max","call","immediateFailure","reject","oneWay","id","postMessage","args","apply","authWithCustomToken","authToken","url","signInWithCustomToken","unauth","signOut","catch","currentUser","callbackId","onAuth","authCallback","_onAuthCallback","onIdTokenChanged","jsonUser","_createRef","update","once","snapshot","_snapshotToJson","on","listenerKey","spec","eventType","options","sync","branch","off","snapshotCallback","_onSnapshotCallback","cancelCallback","_onCancelCallback","rest","path","decodeURIComponent","toString","val","childPath","snapshotJson","transaction","ref$1","stale","committedValue","relativeUpdates","transactionPath","relativePath","object","child","snapshots","committed","onDisconnect","method","refFromURL","by","orderByKey","orderByValue","orderByChild","at","equalTo","from","startAt","to","endAt","first","limitToFirst","last","limitToLast","extra","expose","window"],"mappings":"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","file":"worker.umd.min.js","sourcesContent":["/* globals firebase, setTimeout, setInterval */\n\nconst fireworkers = [];\nconst apps = {};\n// This version is filled in by the build, don't reformat the line.\nconst VERSION = 'dev';\n\n\nclass LocalStorage {\n  constructor() {\n    this._items = [];\n    this._pendingItems = [];\n    this._initialized = false;\n    this._flushPending = this.flushPending.bind(this);\n  }\n\n  init(items) {\n    if (!this._initialized) {\n      this._items = items;\n      this._initialized = true;\n    }\n  }\n\n  _update(item) {\n    if (!this._pendingItems.length) Promise.resolve().then(this._flushPending);\n    this._pendingItems.push(item);\n  }\n\n  flushPending() {\n    if (!this._pendingItems.length) return;\n    if (!fireworkers.length) {\n      setTimeout(this._flushPending, 200);\n      return;\n    }\n    fireworkers[0]._send({msg: 'updateLocalStorage', items: this._pendingItems});\n    this._pendingItems = [];\n  }\n\n  get length() {return this._items.length;}\n\n  key(n) {\n    return this._items[n].key;\n  }\n\n  getItem(key) {\n    for (const item of this._items) {\n      if (item.key === key) return item.value;\n    }\n    return null;\n  }\n\n  setItem(key, value) {\n    let targetItem;\n    for (const item of this._items) {\n      if (item.key === key) {\n        targetItem = item;\n        item.value = value;\n        break;\n      }\n    }\n    if (!targetItem) {\n      targetItem = {key, value};\n      this._items.push(targetItem);\n    }\n    this._update(targetItem);\n  }\n\n  removeItem(key) {\n    for (let i = 0; i < this._items.length; i++) {\n      if (this._items[i].key === key) {\n        this._items.splice(i, 1);\n        this._update({key, value: null});\n        break;\n      }\n    }\n  }\n\n  clear() {\n    for (const item in this._items) {\n      this._update({key: item.key, value: null});\n    }\n    this._items = [];\n  }\n}\n\nself.localStorage = new LocalStorage();\n\n\nclass Branch {\n  constructor() {\n    this._root = null;\n  }\n\n  set(value) {\n    this._root = value;\n  }\n\n  diff(value, pathPrefix) {\n    const updates = {};\n    const segments = pathPrefix === '/' ? [''] : pathPrefix.split('/');\n    if (this._diffRecursively(this._root, value, segments, updates)) {\n      this._root = value;\n      updates[pathPrefix] = value;\n    }\n    return updates;\n  }\n\n  _diffRecursively(oldValue, newValue, segments, updates) {\n    if (oldValue === undefined) oldValue = null;\n    if (newValue === undefined) newValue = null;\n    if (oldValue === null) return newValue !== null;\n    if (oldValue instanceof Object && newValue instanceof Object) {\n      let replace = true;\n      const keysToReplace = [];\n      for (const childKey in newValue) {\n        if (!newValue.hasOwnProperty(childKey)) continue;\n        const replaceChild = this._diffRecursively(\n          oldValue[childKey], newValue[childKey], segments.concat(childKey), updates);\n        if (replaceChild) {\n          keysToReplace.push(childKey);\n        } else {\n          replace = false;\n        }\n      }\n      if (replace) return true;\n      for (const childKey in oldValue) {\n        if (!oldValue.hasOwnProperty(childKey) || newValue.hasOwnProperty(childKey)) continue;\n        updates[segments.concat(childKey).join('/')] = null;\n        delete oldValue[childKey];\n      }\n      for (const childKey of keysToReplace) {\n        updates[segments.concat(childKey).join('/')] = newValue[childKey];\n        oldValue[childKey] = newValue[childKey];\n      }\n    } else {\n      return newValue !== oldValue;\n    }\n  }\n}\n\n\nexport default class Fireworker {\n  constructor(port) {\n    this._port = port;\n    this._lastWriteSerial = 0;\n    this._lastJsonUser = undefined;\n    this._configError = undefined;\n    this._callbacks = {};\n    this._messages = [];\n    this._flushMessageQueue = this._flushMessageQueue.bind(this);\n    port.onmessage = this._receive.bind(this);\n  }\n\n  init({storage, config}) {\n    if (storage) self.localStorage.init(storage);\n    if (config) {\n      try {\n        if (!apps[config.databaseURL]) {\n          apps[config.databaseURL] = firebase.initializeApp(config, config.databaseURL);\n        }\n        this._app = apps[config.databaseURL];\n        this._app.database();\n        this._app.auth();\n        this._configError = undefined;\n      } catch (e) {\n        this._configError = e;\n        throw e;\n      }\n    } else if (this._configError) {\n      throw this._configError;\n    }\n    return {\n      exposedFunctionNames: Object.keys(Fireworker._exposed),\n      version: VERSION,\n      firebaseSdkVersion: firebase.SDK_VERSION\n    };\n  }\n\n  destroy() {\n    for (const key in this._callbacks) {\n      const callback = this._callbacks[key];\n      if (callback.cancel) callback.cancel();\n    }\n    this._callbacks = {};\n    this._port.onmessage = null;\n    this._messages = [];\n    const k = fireworkers.indexOf(this);\n    if (k >= 0) fireworkers[k] = null;\n  }\n\n  ping() {\n    // Noop, placeholder for legacy Firetruss clients.\n  }\n\n  bounceConnection() {\n    if (!this._app) throw new Error('Must provide Firebase configuration data first');\n    this._app.database().goOffline();\n    this._app.database().goOnline();\n  }\n\n  _receive(event) {\n    Fireworker._firstMessageReceived = true;\n    for (const message of event.data) this._receiveMessage(message);\n  }\n\n  _receiveMessage(message) {\n    let promise;\n    try {\n      const fn = this[message.msg];\n      if (typeof fn !== 'function') throw new Error('Unknown message: ' + message.msg);\n      if (message.writeSerial) {\n        this._lastWriteSerial = Math.max(this._lastWriteSerial, message.writeSerial);\n      }\n      promise = Promise.resolve(fn.call(this, message));\n    } catch (e) {\n      e.immediateFailure = true;\n      promise = Promise.reject(e);\n    }\n    if (!message.oneWay) {\n      promise.then(result => {\n        this._send({msg: 'resolve', id: message.id, result});\n      }, error => {\n        this._send({msg: 'reject', id: message.id, error: errorToJson(error)});\n      });\n    }\n  }\n\n  _send(message) {\n    if (!this._messages.length) Promise.resolve().then(this._flushMessageQueue);\n    this._messages.push(message);\n  }\n\n  _flushMessageQueue() {\n    this._port.postMessage(this._messages);\n    this._messages = [];\n  }\n\n  call({name, args}) {\n    try {\n      return Promise.resolve(Fireworker._exposed[name].apply(null, args));\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  }\n\n  authWithCustomToken({url, authToken}) {\n    return this._app.auth().signInWithCustomToken(authToken)\n      .then(result => userToJson(result.user));\n  }\n\n  unauth({url}) {\n    return this._app.auth().signOut().catch(e => {\n      // We can ignore the error if the user is signed out anyway, but make sure to notify all\n      // authCallbacks otherwise we end up in a bogus state!\n      if (this._app.auth().currentUser === null) {\n        for (const callbackId in this._callbacks) {\n          if (!this._callbacks.hasOwnProperty(callbackId)) continue;\n          const callback = this._callbacks[callbackId];\n          if (callback.auth) callback(null);\n        }\n      } else {\n        return Promise.reject(e);\n      }\n    });\n  }\n\n  onAuth({url, callbackId}) {\n    const authCallback = this._callbacks[callbackId] = this._onAuthCallback.bind(this, callbackId);\n    authCallback.auth = true;\n    authCallback.cancel = this._app.auth().onIdTokenChanged(authCallback);\n  }\n\n  _onAuthCallback(callbackId, user) {\n    userToJson(user).then(jsonUser => {\n      if (areEqualValues(this._lastJsonUser, jsonUser)) return;\n      this._lastJsonUser = jsonUser;\n      this._send({msg: 'callback', id: callbackId, args: [jsonUser]});\n    });\n  }\n\n  set({url, value}) {\n    return this._createRef(url).set(value);\n  }\n\n  update({url, value}) {\n    return this._createRef(url).update(value);\n  }\n\n  once({url}) {\n    return this._createRef(url).once('value').then(snapshot => this._snapshotToJson(snapshot));\n  }\n\n  on({listenerKey, url, spec, eventType, callbackId, options}) {\n    options = options || {};\n    if (options.sync) options.branch = new Branch();\n    options.cancel = this.off.bind(this, {listenerKey, url, spec, eventType, callbackId});\n    const snapshotCallback = this._callbacks[callbackId] =\n      this._onSnapshotCallback.bind(this, callbackId, options);\n    snapshotCallback.listenerKey = listenerKey;\n    snapshotCallback.eventType = eventType;\n    snapshotCallback.cancel = options.cancel;\n    const cancelCallback = this._onCancelCallback.bind(this, callbackId);\n    this._createRef(url, spec).on(eventType, snapshotCallback, cancelCallback);\n  }\n\n  off({listenerKey, url, spec, eventType, callbackId}) {\n    let snapshotCallback;\n    if (callbackId) {\n      // Callback IDs will not be reused across on() calls, so it's safe to just delete it.\n      snapshotCallback = this._callbacks[callbackId];\n      delete this._callbacks[callbackId];\n    } else {\n      for (const key of Object.keys(this._callbacks)) {\n        if (!this._callbacks.hasOwnProperty(key)) continue;\n        const callback = this._callbacks[key];\n        if (callback.listenerKey === listenerKey &&\n            (!eventType || callback.eventType === eventType)) {\n          delete this._callbacks[key];\n        }\n      }\n    }\n    this._createRef(url, spec).off(eventType, snapshotCallback);\n  }\n\n  _onSnapshotCallback(callbackId, options, snapshot) {\n    if (options.sync && options.rest) {\n      const path = decodeURIComponent(\n        snapshot.ref.toString().replace(/.*?:\\/\\/[^/]*/, '').replace(/\\/$/, ''));\n      let value;\n      try {\n        value = normalizeFirebaseValue(snapshot.val());\n      } catch (e) {\n        options.cancel();\n        this._onCancelCallback(callbackId, e);\n        return;\n      }\n      const updates = options.branch.diff(value, path);\n      for (const childPath in updates) {\n        if (!updates.hasOwnProperty(childPath)) continue;\n        this._send({\n          msg: 'callback', id: callbackId,\n          args: [null, {\n            path: childPath, value: updates[childPath], writeSerial: this._lastWriteSerial\n          }]\n        });\n      }\n    } else {\n      try {\n        const snapshotJson = this._snapshotToJson(snapshot);\n        if (options.sync) options.branch.set(snapshotJson.value);\n        this._send({msg: 'callback', id: callbackId, args: [null, snapshotJson]});\n        options.rest = true;\n      } catch (e) {\n        options.cancel();\n        this._onCancelCallback(callbackId, e);\n      }\n    }\n  }\n\n  _onCancelCallback(callbackId, error) {\n    delete this._callbacks[callbackId];\n    this._send({msg: 'callback', id: callbackId, args: [errorToJson(error)]});\n  }\n\n  transaction({url, oldValue, relativeUpdates}) {\n    const transactionPath = decodeURIComponent(url.replace(/.*?:\\/\\/[^/]*/, '').replace(/\\/$/, ''));\n    const ref = this._createRef(url);\n    const branch = new Branch();\n    let stale, committedValue;\n\n    return ref.transaction(value => {\n      committedValue = undefined;\n      value = normalizeFirebaseValue(value);\n      stale = !areEqualNormalFirebaseValues(value, oldValue);\n      if (stale) value = oldValue;\n      if (relativeUpdates) {\n        for (const relativePath in relativeUpdates) {\n          if (!relativeUpdates.hasOwnProperty(relativePath)) continue;\n          if (relativePath) {\n            const segments = relativePath.split('/');\n            if (value === undefined || value === null) value = {};\n            let object = value;\n            for (let i = 0; i < segments.length - 1; i++) {\n              const key = segments[i];\n              let child = object[key];\n              if (child === undefined || child === null) child = object[key] = {};\n              object = child;\n            }\n            object[segments[segments.length - 1]] = relativeUpdates[relativePath];\n          } else {\n            value = relativeUpdates[relativePath];\n          }\n        }\n      }\n      branch.set(value);\n      if (!stale) {\n        committedValue = value;\n        return value;\n      }\n    }).then(result => {\n      const snapshots = [];\n      const updates = branch.diff(normalizeFirebaseValue(result.snapshot.val()), transactionPath);\n      for (const path in updates) {\n        if (!updates.hasOwnProperty(path)) continue;\n        snapshots.push({\n          path, value: updates[path], writeSerial: result.writeSerial || this._lastWriteSerial\n        });\n      }\n      return {committed: !stale, snapshots};\n    }, error => {\n      if (error.message === 'set' || error.message === 'disconnect') {\n        return ref.once('value').then(snapshot => {\n          return {committed: false, snapshots: [snapshot], writeSerial: this._lastWriteSerial};\n        });\n      }\n      error.committedValue = committedValue;\n      return Promise.reject(error);\n    });\n  }\n\n  _snapshotToJson(snapshot) {\n    const path =\n      decodeURIComponent(snapshot.ref.toString().replace(/.*?:\\/\\/[^/]*/, '').replace(/\\/$/, ''));\n    return {\n      path, value: normalizeFirebaseValue(snapshot.val()), writeSerial: this._lastWriteSerial\n    };\n  }\n\n  onDisconnect({url, method, value}) {\n    const onDisconnect = this._createRef(url).onDisconnect();\n    return onDisconnect[method](value);\n  }\n\n  _createRef(url, spec) {\n    if (!this._app) throw new Error('Must provide Firebase configuration data first');\n    try {\n      let ref = this._app.database().refFromURL(url);\n      if (spec) {\n        switch (spec.by) {\n          case '$key': ref = ref.orderByKey(); break;\n          case '$value': ref = ref.orderByValue(); break;\n          default: ref = ref.orderByChild(spec.by); break;\n        }\n        if (spec.at) ref = ref.equalTo(spec.at);\n        else if (spec.from) ref = ref.startAt(spec.from);\n        else if (spec.to) ref = ref.endAt(spec.to);\n        if (spec.first) ref = ref.limitToFirst(spec.first);\n        else if (spec.last) ref = ref.limitToLast(spec.last);\n      }\n      return ref;\n    } catch (e) {\n      e.extra = {url, spec};\n      throw e;\n    }\n  }\n\n  static expose(fn, name) {\n    name = name || fn.name;\n    if (!name) throw new Error('Cannot expose a function with no name: ' + fn);\n    if (Fireworker._exposed.hasOwnProperty(name)) {\n      throw new Error(`Function ${name}() already exposed`);\n    }\n    if (Fireworker._firstMessageReceived) {\n      throw new Error('Too late to expose function, worker in use');\n    }\n    Fireworker._exposed[name] = fn;\n  }\n}\n\nFireworker._exposed = {};\nFireworker._firstMessageReceived = false;\n\nfunction errorToJson(error) {\n  const json = {name: error.name, message: error.message};\n  const propertyNames = Object.getOwnPropertyNames(error);\n  for (const propertyName of propertyNames) {\n    json[propertyName] = error[propertyName];\n  }\n  return json;\n}\n\nfunction normalizeFirebaseValue(value) {\n  if (Array.isArray(value)) {\n    const normalValue = {};\n    for (let i = 0; i < value.length; i++) {\n      const item = value[i];\n      if (item === undefined || item === null) continue;\n      normalValue[i] = normalizeFirebaseValue(item);\n    }\n    return normalValue;\n  }\n  if (value instanceof Object) {\n    for (const key in value) {\n      if (value.hasOwnProperty(key)) value[key] = normalizeFirebaseValue(value[key]);\n    }\n  }\n  return value;\n}\n\nfunction userToJson(user) {\n  if (!user) return Promise.resolve(user);\n  const json = user.toJSON();\n  delete json.stsTokenManager;\n  return user.getIdTokenResult().then(result => {\n    delete result.claims.exp;\n    delete result.claims.iat;\n    json.claims = result.claims;\n    return json;\n  });\n}\n\n\nfunction areEqualNormalFirebaseValues(a, b) {\n  if (a === b) return true;\n  if ((a === null || a === undefined) && (b === null || b === undefined)) return true;\n  if (a === null || b === null) return false;\n  if (!(typeof a === 'object' && typeof b === 'object')) return false;\n  for (const key in a) {\n    if (!a.hasOwnProperty(key) || !b.hasOwnProperty(key)) return false;\n    if (!areEqualNormalFirebaseValues(a[key], b[key])) return false;\n  }\n  for (const key in b) {\n    if (!a.hasOwnProperty(key) || !b.hasOwnProperty(key)) return false;\n  }\n  return true;\n}\n\nfunction areEqualValues(a, b) {\n  if (a === b) return true;\n  if (a === null && b === null || a === undefined && b === undefined) return true;\n  if (a === null || b === null || a === undefined || b === undefined) return false;\n  if (!(typeof a === 'object' && typeof b === 'object')) return false;\n  for (const key in a) {\n    if (!a.hasOwnProperty(key) || !b.hasOwnProperty(key)) return false;\n    if (!areEqualValues(a[key], b[key])) return false;\n  }\n  for (const key in b) {\n    if (!a.hasOwnProperty(key) || !b.hasOwnProperty(key)) return false;\n  }\n  if (Array.isArray(a) || Array.isArray(b)) {\n    if (!Array.isArray(a) || !Array.isArray(b)) return false;\n    if (a.length !== b.length) return false;\n    for (let i = 0; i < a.length; i++) {\n      if (!areEqualValues(a[i], b[i])) return false;\n    }\n  }\n  return true;\n}\n\nfunction acceptConnections() {\n  if (typeof onconnect !== 'undefined') {\n    self.onconnect = function(event) {\n      fireworkers.push(new Fireworker(event.ports[0]));\n    };\n  } else {\n    fireworkers.push(new Fireworker(self));\n  }\n  self.localStorage.flushPending();\n}\n\nself.window = self;\nacceptConnections();\n"]}